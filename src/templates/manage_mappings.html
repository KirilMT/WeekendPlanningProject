<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Skill-Based Mappings Management - Weekend Planning</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_mappings.css') }}">
</head>
<body>
<div class="container">
    <header class="page-header">
        <div class="header-content">
            <h1>Skill-Based Mappings Management</h1>
            <p class="header-subtitle">Configure technician skills, task requirements, and organizational structure</p>
        </div>
        <nav class="header-nav">
            <button id="backToDashboardBtn" class="btn btn-outline">
                <span class="btn-icon">‚Üê</span>
                Back to Dashboard
            </button>
        </nav>
    </header>

    <main class="main-content">
        <!-- Manage Satellite Points and Lines Section -->
        <section id="manageSatelliteLinesSection" class="management-section">
            <header class="section-header" role="button" tabindex="0" aria-expanded="false">
                <div class="section-title">
                    <h2>üìç Satellite Points & Production Lines</h2>
                    <p class="section-description">Manage organizational locations and production line assignments</p>
                </div>
                <span class="toggle-icon" aria-label="Toggle section">‚ñº</span>
            </header>
            <div class="section-content" id="satelliteLinesContent">
                <!-- Satellite Points Management -->
                <div class="subsection">
                    <h3>Satellite Points</h3>
                    <form class="inline-form" id="satellitePointForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newSatellitePointName" name="satellitePointName"
                                   placeholder="New satellite point name"
                                   aria-label="New satellite point name"
                                   class="form-control" maxlength="50" required>
                        </div>
                        <button type="submit" id="addSatellitePointBtn" class="btn btn-success">
                            <span class="btn-icon">+</span>
                            Add Point
                        </button>
                    </form>
                    <div id="satellitePointListContainer" class="list-container">
                        <!-- Satellite Points will be listed here -->
                    </div>
                </div>

                <hr class="section-divider">

                <!-- Lines Management -->
                <div class="subsection">
                    <h3>Production Lines</h3>
                    <form class="inline-form" id="productionLineForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newLineName" name="lineName"
                                   placeholder="New line name"
                                   aria-label="New line name"
                                   class="form-control" maxlength="30" required>
                        </div>
                        <div class="form-group">
                            <select id="newLineSatellitePointSelect" name="satellitePointId"
                                    class="form-control" required
                                    aria-label="Assign to Satellite Point">
                                <option value="">Select Satellite Point</option>
                                <!-- Options populated by JavaScript -->
                            </select>
                        </div>
                        <button type="submit" id="addLineBtn" class="btn btn-success">
                            <span class="btn-icon">+</span>
                            Add Line
                        </button>
                    </form>

                    <div id="lineListContainer" class="list-container">
                        <!-- Lines will be listed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Technologies & Groups Section -->
        <section id="manageTechnologiesSection" class="management-section">
            <header class="section-header" role="button" tabindex="0" aria-expanded="false">
                <div class="section-title">
                    <h2>üîß Skills & Technologies</h2>
                    <p class="section-description">Define skill hierarchies and technology groups for task assignments</p>
                </div>
                <span class="toggle-icon" aria-label="Toggle section">‚ñº</span>
            </header>
            <div class="section-content" id="technologiesContent">
                <!-- Technology Groups -->
                <div class="subsection">
                    <h3>Technology Groups</h3>
                    <form class="inline-form" id="technologyGroupForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newTechnologyGroupName" name="groupName"
                                   placeholder="New group name"
                                   aria-label="New technology group name"
                                   class="form-control" maxlength="50" required>
                        </div>
                        <button type="submit" id="addTechnologyGroupBtn" class="btn btn-success">
                            <span class="btn-icon">+</span>
                            Add Group
                        </button>
                    </form>
                    <div id="technologyGroupListContainer" class="list-container">
                        <!-- Technology Groups will be listed here -->
                    </div>
                </div>

                <hr class="section-divider">

                <!-- Technologies (Hierarchical) -->
                <div class="subsection">
                    <h3>Technologies & Skills (Hierarchical)</h3>
                    <form class="inline-form multi-field" id="technologyForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newTechnologyName" name="technologyName"
                                   placeholder="New technology/skill name"
                                   aria-label="New technology name"
                                   class="form-control" maxlength="50" required>
                        </div>
                        <div class="form-group">
                            <select id="newTechnologyGroupSelect" name="groupId"
                                    class="form-control"
                                    aria-label="Assign to Group">
                                <option value="">No Group</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select id="newTechnologyParentSelect" name="parentId"
                                    class="form-control"
                                    aria-label="Assign Parent Technology">
                                <option value="">No Parent (Top Level)</option>
                            </select>
                        </div>
                        <button type="submit" id="addTechnologyBtn" class="btn btn-success">
                            <span class="btn-icon">+</span>
                            Add Technology
                        </button>
                    </form>
                    <div id="technologyListContainer" class="list-container hierarchical">
                        <!-- Technologies will be listed here, grouped and hierarchical -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Task-Technology Mappings Section -->
        <section id="manageTaskTechnologySection" class="management-section">
            <header class="section-header" role="button" tabindex="0" aria-expanded="false">
                <div class="section-title">
                    <h2>‚öôÔ∏è Task-Skill Requirements</h2>
                    <p class="section-description">Define which skills are required for each task type</p>
                </div>
                <span class="toggle-icon" aria-label="Toggle section">‚ñº</span>
            </header>
            <div class="section-content" id="taskTechnologyContent">
                <!-- New Task Creation -->
                <div class="subsection">
                    <h3>Create New Task Type</h3>
                    <form class="inline-form multi-field" id="newTaskForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group" style="flex: 1; align-self: flex-start;">
                            <input type="text" id="newTaskNameForMapping" name="taskName"
                                   placeholder="New task name"
                                   aria-label="New task name for mapping"
                                   class="form-control" maxlength="100" required>
                        </div>
                        <div class="form-group" style="flex: 1; align-self: flex-start;">
                            <div style="display: flex; align-items: flex-end; gap: 8px;">
                                <div style="flex-grow: 1;">
                                    <input type="text" id="newTaskTechnologySearch"
                                           class="form-control search-input"
                                           placeholder="Search skills/technologies..."
                                           aria-label="Search technologies">
                                    <select id="newTaskTechnologySelectForMapping"
                                            name="requiredSkills"
                                            class="form-control skill-select"
                                            multiple required
                                            aria-label="Select required skills for task"
                                            title="Hold Ctrl/Cmd to select multiple skills">
                                        <!-- Options populated by JavaScript -->
                                    </select>
                                </div>
                                <button type="submit" id="addNewTaskForMappingBtn" class="btn btn-success">
                                    <span class="btn-icon">+</span>
                                    Create Task
                                </button>
                            </div>
                            <small class="help-text">Hold Ctrl/Cmd to select multiple required skills</small>
                        </div>
                    </form>
                </div>

                <hr class="section-divider">

                <!-- Existing Task List -->
                <div class="subsection">
                    <h3>Existing Task Types & Required Skills</h3>
                    <div class="section-help">
                        <p>Manage existing task types and their skill requirements. Click <strong>Edit</strong> to modify or <strong>Delete</strong> to remove a task type.</p>
                    </div>
                    <div id="taskTechnologyMappingListContainer" class="list-container task-mappings">
                        <!-- Task-technology mappings will be listed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Technician Groups Section -->
        <section id="manageTechnicianGroupsSection" class="management-section">
            <header class="section-header" role="button" tabindex="0" aria-expanded="false">
                <div class="section-title">
                    <h2>üë• Technician Groups & Priorities</h2>
                    <p class="section-description">Manage technician groups, members, and task priorities</p>
                </div>
                <span class="toggle-icon" aria-label="Toggle section">‚ñº</span>
            </header>
            <div class="section-content" id="technicianGroupsContent">
                <div class="subsection">
                    <h3>Create New Technician Group</h3>
                    <form class="inline-form" id="technicianGroupForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newTechnicianGroupName" name="groupName"
                                   placeholder="New group name"
                                   aria-label="New technician group name"
                                   class="form-control" maxlength="50" required>
                        </div>
                        <button type="submit" id="addTechnicianGroupBtn" class="btn btn-success">
                            <span class="btn-icon">‚ûï</span>
                            Add Group
                        </button>
                    </form>
                    <div id="technicianGroupListContainer" class="list-container">
                        <!-- Technician Groups will be listed here -->
                    </div>
                </div>

                <hr class="section-divider">

                <div class="subsection">
                    <h3>Group Membership</h3>
                    <div class="form-group">
                        <label for="groupMembershipSelect">Select Group to Manage</label>
                        <select id="groupMembershipSelect" class="form-control" aria-label="Select Group">
                            <option value="">Choose a group...</option>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>

                    <div id="groupMembershipDetails" style="display:none;">
                        <h4>Edit Members for <strong id="selectedGroupName"></strong></h4>
                        <div class="technician-transfer-lists">
                            <div class="technician-list-container">
                                <label for="availableTechniciansSearch">Available Technicians <span id="availableTechniciansCount">(0)</span></label>
                                <div class="search-wrapper">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="availableTechniciansSearch" class="form-control search-input" placeholder="Search...">
                                </div>
                                <div id="availableTechniciansList" class="technician-list">
                                    <!-- Available technicians will be listed here -->
                                </div>
                            </div>
                            <div class="technician-transfer-actions">
                                <button id="addTechnicianToGroupBtn" class="btn btn-primary" disabled>
                                    <span class="btn-icon">‚û°Ô∏è</span>
                                </button>
                                <button id="removeTechnicianFromGroupBtn" class="btn btn-primary" disabled>
                                    <span class="btn-icon">‚¨ÖÔ∏è</span>
                                </button>
                            </div>
                            <div class="technician-list-container">
                                <label for="groupMembersSearch">Group Members <span id="groupMembersCount">(0)</span></label>
                                <div class="search-wrapper">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="groupMembersSearch" class="form-control search-input" placeholder="Search...">
                                </div>
                                <div id="groupMembersList" class="technician-list">
                                    <!-- Group members will be listed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Technician Details Section -->
        <section id="manageTechnicianDetailsSection" class="management-section">
            <header class="section-header" role="button" tabindex="0" aria-expanded="false">
                <div class="section-title">
                    <h2>üë®‚Äçüîß Technician Skills & Details</h2>
                    <p class="section-description">Manage individual technician profiles and skill levels (0-4 scale)</p>
                </div>
                <span class="toggle-icon" aria-label="Toggle section">‚ñº</span>
            </header>
            <div class="section-content" id="technicianDetailsContent">
                <!-- Add New Technician -->
                <div class="subsection">
                    <h3>Add New Technician</h3>
                    <form id="addNewTechnicianForm" class="inline-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="form-group">
                            <input type="text" id="newTechnicianNameInput" name="technicianName"
                                   placeholder="Enter technician name"
                                   aria-label="Technician Name"
                                   class="form-control" maxlength="50" required>
                        </div>
                        <div class="form-group">
                            <select id="newTechnicianSatellitePointSelect" name="satellitePointId"
                                    class="form-control"
                                    aria-label="Select Satellite Point">
                                <option value="">Select Satellite Point</option>
                                <!-- Options populated by JavaScript -->
                            </select>
                        </div>
                        <button type="submit" id="saveNewTechnicianBtn" class="btn btn-success">
                            <span class="btn-icon">üíæ</span>
                            Save Technician
                        </button>
                    </form>

                </div>

                <hr class="section-divider">

                <!-- Technician Selection & Details -->
                <div class="subsection">
                    <div class="technician-selector">
                        <div class="form-group">
                            <label for="technicianSelect">Select Technician to Manage</label>
                            <div class="selector-controls">
                                <select id="technicianSelect" class="form-control" aria-label="Select Technician">
                                    <option value="">Choose a technician...</option>
                                </select>
                                <div class="action-buttons">
                                    <button id="editTechnicianNameBtn" type="button" class="btn btn-warning btn-sm" style="display:none;">
                                        <span class="btn-icon">‚úèÔ∏è</span>
                                        Edit Name
                                    </button>
                                    <button id="deleteTechnicianBtn" type="button" class="btn btn-danger btn-sm" style="display:none;">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="technicianDetails" class="technician-details" style="display:none;">
                        <div class="technician-header">
                            <h3 id="currentTechNameDisplay" class="technician-name"></h3>
                            <div class="technician-info">
                                <label for="techSatellitePointSelect">Satellite Point:</label>
                                <span id="techSatellitePointNameDisplay" class="info-value"></span>
                                <button id="editTechSatellitePointBtn" type="button" class="btn btn-sm btn-warning">
                                    <span class="btn-icon">‚úèÔ∏è</span>
                                    Edit
                                </button>
                                <select id="techSatellitePointSelect" class="form-control" style="display:none;">
                                    <!-- Options populated by JavaScript -->
                                </select>
                            </div>
                        </div>

                        <!-- Skills Management -->
                        <div class="skills-section">
                            <h4>üéØ Skill Levels (0-4 Scale)</h4>
                            <div class="skill-level-legend">
                                <span class="legend-item" title="The technician has no prior experience or training with this technology."><span class="level-badge level-0">0</span> No Experience</span>
                                <span class="legend-item" title="The technician has basic knowledge and can perform simple tasks with supervision."><span class="level-badge level-1">1</span> Beginner</span>
                                <span class="legend-item" title="The technician can work independently on most common tasks and may need help with complex issues."><span class="level-badge level-2">2</span> Intermediate</span>
                                <span class="legend-item" title="The technician has a deep understanding and can handle complex tasks and troubleshoot difficult problems."><span class="level-badge level-3">3</span> Advanced</span>
                                <span class="legend-item" title="The technician is a subject matter expert who can train others and lead complex projects."><span class="level-badge level-4">4</span> Expert</span>
                            </div>
                            <div id="technicianSkillsListContainer" class="skills-grid">
                                <!-- Technician skills will be populated here -->
                            </div>
                        </div>

                        <!-- Task Assignments Preview -->
                        <div class="assignments-section">
                            <h4>üîÑ Potential Task Assignments</h4>
                            <div id="taskList" class="task-assignments-preview">
                                <!-- Tasks will be dynamically populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Global Actions -->
    <footer class="page-footer">
        <div class="global-actions">
            <div id="statusMessage" class="status-message" role="status" aria-live="polite"></div>
        </div>
    </footer>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Processing changes...</p>
    </div>
</div>

<script src="{{ url_for('static', filename='js/manage_mappings_globals.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_satellite_lines.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technologies.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_task_technology.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_data.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_skills.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_groups.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_main.js') }}"></script>
</body>
</html>