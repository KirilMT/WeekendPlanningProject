<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Mappings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_mappings.css') }}">
</head>
<body>
<div class="container">
    <div class="header-controls">
        <h1>Manage Mappings</h1>
        <button id="backToDashboardBtn" class="button-link">Back to Dashboard Upload</button>
    </div>

    <!-- Manage Technologies & Groups Section (Hierarchical) -->
    <div id="manageTechnologiesSection" class="section">
        <div class="section-header">
            <h2>Manage Technologies & Groups</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <h4>Technology Groups</h4>
            <div id="technologyGroupListContainer" style="max-height: 150px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technology Groups will be listed here -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newTechnologyGroupName" placeholder="New group name"
                       aria-label="New technology group name">
                <button id="addTechnologyGroupBtn">Add Group</button>
            </div>

            <hr style="margin: 20px 0;">

            <h4>Technologies (Hierarchical)</h4>
            <div id="technologyListContainer" style="max-height: 300px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technologies will be listed here, grouped and hierarchical -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newTechnologyName" placeholder="New technology name"
                       aria-label="New technology name">
                <select id="newTechnologyGroupSelect" style="margin-left:10px; flex-grow:0.5;" title="Assign to Group"
                        aria-label="Assign to Group">
                    <option value="">No Group</option>
                </select>
                <select id="newTechnologyParentSelect" style="margin-left:10px; flex-grow:0.5;"
                        title="Assign Parent Technology" aria-label="Assign Parent Technology">
                    <option value="">No Parent (Top Level)</option>
                </select>
                <button id="addTechnologyBtn" style="margin-left:10px;">Add Technology</button>
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Task-Technology Mappings Section -->
    <div id="manageTaskTechnologySection" class="section">
        <div class="section-header">
            <h2>Manage Task-Technology Mappings</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <!-- New Task Creation Area -->
            <h4>Add New Task</h4>
            <div class="form-inline-group" id="addNewTaskFormContainer">
                <input type="text" id="newTaskNameForMapping" placeholder="New task name" aria-label="New task name for mapping" style="flex-grow: 1.5;">
                <select id="newTaskTechnologySelectForMapping" style="flex-grow:1;" title="Assign Technology to New Task (Required)" aria-label="Assign Technology to New Task">
                    <!-- Options will be populated by JS -->
                </select>
                <button id="addNewTaskForMappingBtn">Add Task</button>
            </div>
            <hr style="margin: 20px 0;">

            <!-- Existing Task List Area -->
            <h4>Existing Tasks</h4>
            <p>View tasks and their assigned technologies. Click 'Edit' to modify a task's name or technology, or 'Delete' to remove it.
            Changes to technology assignments via the select lists in view mode are saved immediately if no explicit 'Edit' mode is active for that row.
            </p>
            <div id="taskTechnologyMappingListContainer" style="max-height: 400px; overflow-y: auto; margin-top: 10px;">
                <!-- Task-technology mappings will be listed here -->
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Specialities Section -->
    <div id="manageSpecialitiesSection" class="section">
        <div class="section-header">
            <h2>Manage Specialities</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <div id="specialityListContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Specialities will be listed here -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newSpecialityName" placeholder="New speciality name"
                       aria-label="New speciality name">
                <button id="addSpecialityBtn">Add Speciality</button>
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Technician Details Section -->
    <div id="manageTechnicianDetailsSection" class="section">
        <div class="section-header">
            <h3>Technician Details</h3>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <label for="technicianSelect">Select Technician:</label>
            <select id="technicianSelect" aria-label="Select Technician"></select>

            <div id="technicianDetails" style="margin-top: 20px; display: none;">
                <h4 id="currentTechName"></h4>
                <label for="techSattelitePoint">Sattelite Point:</label>
                <input type="text" id="techSattelitePoint">

                <label for="techLines">Lines (comma-separated):</label>
                <input type="text" id="techLines">

                <!-- Foldable Subsection for Specialities -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h4>Technician Specialities</h4>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="subsection-content collapsed">
                        <div id="technicianSpecialitiesContainer" style="margin-bottom: 10px;">
                            <!-- Assigned specialities will be listed here -->
                        </div>
                        <div class="form-inline-group">
                            <select id="assignSpecialitySelect" style="flex-grow:1;"
                                    aria-label="Select speciality to add to technician">
                                <option value="">Select speciality to add</option>
                            </select>
                            <button id="assignSpecialityBtn">Add Speciality to Technician</button>
                        </div>
                    </div>
                </div>

                <!-- Foldable Subsection for Technology Skills -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h4>Technology Skills (Hierarchical)</h4>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="subsection-content collapsed">
                        <div id="technicianSkillsListContainer" style="max-height: 300px; overflow-y: auto;">
                            <!-- Technician skills will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- Foldable Subsection for Task Assignments -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h4>Task Assignments</h4>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="subsection-content collapsed" style="max-height: 450px; overflow-y: auto;">
                        <div id="taskList"></div>
                        <button id="addTaskBtn">Add Task</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="saveChangesBtn">Save All Changes</button>
    <div id="statusMessage"></div>
</div>
<script src="{{ url_for('static', filename='js/manage_mappings.js') }}"></script>
</body>
</html>
