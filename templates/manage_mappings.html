<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Mappings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_mappings.css') }}">
</head>
<body>
<div class="container">
    <div class="header-controls">
        <h1>Manage Mappings</h1>
        <button id="backToDashboardBtn" class="button-link">Back to Dashboard Upload</button>
    </div>

    <!-- Manage Satellite Points and Lines Section -->
    <div id="manageSatelliteLinesSection" class="section">
        <div class="section-header">
            <h2>Manage Satellite Points & Lines</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <!-- Satellite Points Management -->
            <h4>Satellite Points</h4>
            <div id="satellitePointListContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Satellite Points will be listed here -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newSatellitePointName" placeholder="New satellite point name" aria-label="New satellite point name">
                <button id="addSatellitePointBtn">Add Satellite Point</button>
            </div>

            <hr style="margin: 20px 0;">

            <!-- Lines Management -->
            <h4>Lines</h4>
            <div id="lineListContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Lines will be listed here -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newLineName" placeholder="New line name" aria-label="New line name">
                <select id="newLineSatellitePointSelect" style="margin-left:10px;" title="Assign to Satellite Point" aria-label="Assign to Satellite Point">
                    <!-- Satellite Point options will be populated by JS -->
                    <option value="">Select Satellite Point</option>
                </select>
                <button id="addLineBtn" style="margin-left:10px;">Add Line</button>
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Technologies & Groups Section (Hierarchical) -->
    <div id="manageTechnologiesSection" class="section">
        <div class="section-header">
            <h2>Manage Technologies & Groups</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <h4>Technology Groups</h4>
            <div id="technologyGroupListContainer" style="max-height: 150px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technology Groups will be listed here -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newTechnologyGroupName" placeholder="New group name"
                       aria-label="New technology group name">
                <button id="addTechnologyGroupBtn">Add Group</button>
            </div>

            <hr style="margin: 20px 0;">

            <h4>Technologies (Hierarchical)</h4>
            <div id="technologyListContainer" style="max-height: 300px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technologies will be listed here, grouped and hierarchical -->
            </div>
            <div class="form-inline-group">
                <input type="text" id="newTechnologyName" placeholder="New technology name"
                       aria-label="New technology name">
                <select id="newTechnologyGroupSelect" style="margin-left:10px; flex-grow:0.5;" title="Assign to Group"
                        aria-label="Assign to Group">
                    <option value="">No Group</option>
                </select>
                <select id="newTechnologyParentSelect" style="margin-left:10px; flex-grow:0.5;"
                        title="Assign Parent Technology" aria-label="Assign Parent Technology">
                    <option value="">No Parent (Top Level)</option>
                </select>
                <button id="addTechnologyBtn" style="margin-left:10px;">Add Technology</button>
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Task-Technology Mappings Section -->
    <div id="manageTaskTechnologySection" class="section">
        <div class="section-header">
            <h2>Manage Task-Technology Mappings</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <!-- New Task Creation Area -->
            <h4>Add New Task</h4>
            <div class="form-inline-group" id="addNewTaskFormContainer">
                <input type="text" id="newTaskNameForMapping" placeholder="New task name" aria-label="New task name for mapping" style="flex-grow: 1.5;">
                <select id="newTaskTechnologySelectForMapping" style="flex-grow:1; min-height: 60px;" title="Assign Technologies to New Task (Required, Ctrl+Click for multiple)" aria-label="Assign Technologies to New Task" multiple>
                    <!-- Options will be populated by JS -->
                </select>
                <button id="addNewTaskForMappingBtn">Add Task</button>
            </div>
            <hr style="margin: 20px 0;">

            <!-- Existing Task List Area -->
            <h4>Existing Tasks</h4>
            <p>View tasks and their assigned technologies. Click 'Edit' to modify a task's name or technology, or 'Delete' to remove it.
            Changes to technology assignments via the select lists in view mode are saved immediately if no explicit 'Edit' mode is active for that row.
            </p>
            <div id="taskTechnologyMappingListContainer" style="max-height: 400px; overflow-y: auto; margin-top: 10px;">
                <!-- Task-technology mappings will be listed here -->
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Technician Details Section -->
    <div id="manageTechnicianDetailsSection" class="section">
        <div class="section-header">
            <h3>Technician Details</h3>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <label for="technicianSelect">Select Technician:</label>
            <select id="technicianSelect" aria-label="Select Technician"></select>

            <div id="technicianDetails" style="display:none;">
                <h3 id="currentTechNameDisplay"></h3>
                <div>
                    <label for="techSatellitePointSelect">Satellite Point:</label>
                    <select id="techSatellitePointSelect">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>

                <h4>Tasks (Skill-Based View)</h4>
                <div id="taskList" class="task-list-container">
                    <!-- Tasks will be dynamically populated here -->
                </div>

                <h4>Technician Skills</h4>
                <div id="technicianSkillsListContainer" class="skills-list-container">
                    <!-- Technician skills will be populated here -->
                </div>

                <div class="actions-container">
                    <!-- <button onclick="saveAllChanges()" id="saveTechnicianDataBtn" class="action-button">Save Technician Data</button> --> <!-- Removed -->
                </div>
            </div>
        </div>
    </div>

    <button id="saveChangesBtn">Save All Changes</button>
    <div id="statusMessage"></div>
</div>
<script src="{{ url_for('static', filename='js/manage_mappings_globals.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_satellite_lines.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technologies.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_skills.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_task_technology.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_data.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_main.js') }}"></script>
</body>
</html>
