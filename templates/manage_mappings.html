<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Mappings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_mappings.css') }}">
</head>
<body>
<div class="container">
    <div class="header-controls">
        <h1>Manage Mappings</h1>
        <button id="backToDashboardBtn" class="button-link">Back to Dashboard Upload</button>
    </div>

    <!-- Manage Satellite Points and Lines Section -->
    <div id="manageSatelliteLinesSection" class="section">
        <div class="section-header">
            <h2>Manage Satellite Points & Lines</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <!-- Satellite Points Management -->
            <h4>Satellite Points</h4>
            <div class="form-inline-group" style="margin-bottom: 15px;"> <!-- Moved Up & added margin -->
                <input type="text" id="newSatellitePointName" placeholder="New satellite point name" aria-label="New satellite point name">
                <button id="addSatellitePointBtn" class="button-add">Add Satellite Point</button> <!-- Added class for styling -->
            </div>
            <div id="satellitePointListContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Satellite Points will be listed here -->
            </div>

            <hr style="margin: 20px 0;">

            <!-- Lines Management -->
            <h4>Lines</h4>
            <div class="form-inline-group" style="margin-bottom: 15px;"> <!-- Moved Up & added margin -->
                <input type="text" id="newLineName" placeholder="New line name" aria-label="New line name">
                <select id="newLineSatellitePointSelect" style="margin-left:10px;" title="Assign to Satellite Point" aria-label="Assign to Satellite Point">
                    <option value="">Select Satellite Point</option>
                    <!-- Satellite Point options will be populated by JS -->
                </select>
                <button id="addLineBtn" style="margin-left:10px;" class="button-add">Add Line</button> <!-- Added class for styling -->
            </div>
            <div id="newLineError" class="error-message" style="display:none; color: red; margin-top: 5px;"></div> <!-- Added this line -->
            <div id="lineListContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Lines will be listed here -->
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Technologies & Groups Section (Hierarchical) -->
    <div id="manageTechnologiesSection" class="section">
        <div class="section-header">
            <h2>Manage Technologies & Groups</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <h4>Technology Groups</h4>
            <div class="form-inline-group" style="margin-bottom: 15px;"> <!-- Moved Up & added margin -->
                <input type="text" id="newTechnologyGroupName" placeholder="New group name"
                       aria-label="New technology group name">
                <button id="addTechnologyGroupBtn" class="button-add">Add Group</button> <!-- Added class for styling -->
            </div>
            <div id="technologyGroupListContainer" style="max-height: 150px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technology Groups will be listed here -->
            </div>

            <hr style="margin: 20px 0;">

            <h4>Technologies (Hierarchical)</h4>
            <div class="form-inline-group" style="margin-bottom: 15px;"> <!-- Moved Up & added margin -->
                <input type="text" id="newTechnologyName" placeholder="New technology name"
                       aria-label="New technology name">
                <select id="newTechnologyGroupSelect" style="margin-left:10px; flex-grow:0.5;" title="Assign to Group"
                        aria-label="Assign to Group">
                    <option value="">No Group</option>
                </select>
                <select id="newTechnologyParentSelect" style="margin-left:10px; flex-grow:0.5;"
                        title="Assign Parent Technology" aria-label="Assign Parent Technology">
                    <option value="">No Parent (Top Level)</option>
                </select>
                <button id="addTechnologyBtn" style="margin-left:10px;" class="button-add">Add Technology</button> <!-- Added class for styling -->
            </div>
            <div id="technologyListContainer" style="max-height: 300px; overflow-y: auto; margin-bottom: 10px;">
                <!-- Technologies will be listed here, grouped and hierarchical -->
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Task-Technology Mappings Section -->
    <div id="manageTaskTechnologySection" class="section">
        <div class="section-header">
            <h2>Manage Task-Technology Mappings</h2>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <!-- New Task Creation Area -->
            <h4>Add New Task</h4>
            <div class="form-inline-group" id="addNewTaskFormContainer">
                <input type="text" id="newTaskNameForMapping" placeholder="New task name" aria-label="New task name for mapping" style="flex-grow: 1.5;">
                <div style="flex-grow:1; display: flex; flex-direction: column;">
                    <input type="text" id="newTaskTechnologySearch" class="select-search-input" placeholder="Search technologies...">
                    <select id="newTaskTechnologySelectForMapping" style="width: 100%;" class="task-technology-select" title="Assign Technologies to New Task (Required, Ctrl+Click for multiple)" aria-label="Assign Technologies to New Task" multiple>
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <button id="addNewTaskForMappingBtn">Add Task</button>
            </div>
            <hr style="margin: 20px 0;">

            <!-- Existing Task List Area -->
            <h4>Existing Tasks</h4>
            <p>View tasks and their assigned technologies. Click 'Edit' to modify a task's name or technology, or 'Delete' to remove it.
            Changes to technology assignments via the select lists in view mode are saved immediately if no explicit 'Edit' mode is active for that row.
            </p>
            <div id="taskTechnologyMappingListContainer" style="max-height: 400px; overflow-y: auto; margin-top: 10px;">
                <!-- Task-technology mappings will be listed here -->
            </div>
        </div>
    </div>
    <div class="section-divider"></div>

    <!-- Manage Technician Details Section -->
    <div id="manageTechnicianDetailsSection" class="section">
        <div class="section-header">
            <h3>Technician Details</h3>
            <span class="toggle-icon">+</span>
        </div>
        <div class="section-content collapsed">
            <div class="form-inline-group" style="margin-bottom: 15px;"> <!-- Container for Add button -->
                 <button id="addNewTechnicianBtn" class="button-add">Add New Technician</button>
            </div>

            <!-- New Technician Form - Initially Hidden -->
            <div id="addNewTechnicianFormContainer" style="display:none; border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; background-color: #f9f9f9;">
                <h4>Add New Technician Details</h4>
                <div class="form-group">
                    <label for="newTechnicianNameInput">Technician Name:</label>
                    <input type="text" id="newTechnicianNameInput" placeholder="Enter technician name" aria-label="Technician Name">
                </div>
                <div class="form-group">
                    <label for="newTechnicianSatellitePointSelect">Satellite Point:</label>
                    <select id="newTechnicianSatellitePointSelect" aria-label="Select Satellite Point" disabled>
                        <option value="">Select Satellite Point</option>
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div class="form-actions" style="margin-top: 10px;">
                    <button id="saveNewTechnicianBtn" class="button-save">Save</button>
                    <button id="cancelNewTechnicianBtn" class="button-cancel">Cancel</button>
                </div>
                 <div id="newTechnicianError" class="error-message" style="display:none; color: red; margin-top: 10px;"></div>
            </div>
            <!-- End New Technician Form -->

            <div class="form-inline-group"> <!-- Container for select and its action buttons -->
                <label for="technicianSelect" style="margin-right: 10px; white-space: nowrap;">Select Technician:</label>
                <select id="technicianSelect" aria-label="Select Technician" style="flex-grow: 1; margin-right:10px;"></select>
                <button id="editTechnicianNameBtn" type="button" class="edit-btn" style="margin-left: 0px; display:none;">Edit Name</button> <!-- Added class, removed margin-left, initially hidden -->
                <button id="deleteTechnicianBtn" type="button" class="delete-btn" style="display:none;">Delete Technician</button> <!-- Added class, initially hidden -->
            </div>

            <div id="technicianDetails" style="display:none; margin-top:15px;">
                <h3 id="currentTechNameDisplay"></h3>
                <div>
                    <label>Satellite Point:</label> <!-- Removed 'for' attribute -->
                    <span id="techSatellitePointNameDisplay" class="editable-field-display"></span>
                    <button id="editTechSatellitePointBtn" type="button" class="edit-button" style="margin-left: 8px;">Edit</button>
                    <select id="techSatellitePointSelect" class="editable-field-input" style="display:none; margin-left: 5px;">
                        <!-- Options will be populated by JS -->
                    </select>
                    <!-- A save/cancel for this specific edit could be added here if desired, -->
                    <!-- but for now, we'll rely on the global 'Save All Changes' button -->
                </div>

                <h4>Tasks (Skill-Based View)</h4>
                <div id="taskList" class="task-list-container">
                    <!-- Tasks will be dynamically populated here -->
                </div>

                <h4>Technician Skills</h4>
                <div id="technicianSkillsListContainer" class="skills-list-container">
                    <!-- Technician skills will be populated here -->
                </div>

                <div class="actions-container">
                    <!-- <button onclick="saveAllChanges()" id="saveTechnicianDataBtn" class="action-button">Save Technician Data</button> --> <!-- Removed -->
                </div>
            </div>
        </div>
    </div>

    <button id="saveChangesBtn">Save All Changes</button>
    <div id="statusMessage"></div>
</div>
<script src="{{ url_for('static', filename='js/manage_mappings_globals.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_satellite_lines.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technologies.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_skills.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_task_technology.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_technician_data.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage_mappings_main.js') }}"></script>
</body>
</html>
